<header class="header">
  <div class="header__inner">
    <div class="header__logo">
      {{ partial "logo.html" . }}
    </div>

    <!-- Theme toggle â€“ Sun (light) / Moon (dark) -->
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle between light and dark mode">
      <span class="light-icon ascii">1</span>
      <span class="dark-icon ascii">0</span>
    </button>

    {{ if len $.Site.Menus }}
      {{ partial "mobile-menu.html" . }}
    {{ end }}

    {{ if and $.Site.Params.showLanguageSelector (len $.Site.Home.AllTranslations) }}
      {{ partial "language-menu.html" . }}
    {{ end }}
  </div>

  {{ if len $.Site.Menus }}
    {{ partial "menu.html" . }}
  {{ end }}

  <!-- ðŸ” Search (below terminal/menu) -->
  <div class="header-search">
    <input
      id="siteSearch"
      type="text"
      placeholder="Search postsâ€¦"
      autocomplete="off"
    >
    <div id="searchResults"></div>
  </div>

  <!-- All-in-one styles -->
  <style>
    /* ================= THEME TOGGLE ================= */

    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.7rem;
      font-family: monospace;
      font-weight: bold;
      padding: 0.4rem 0.9rem;
      margin-left: auto;
      color: var(--foreground);
      transition: color 0.3s ease, transform 0.15s ease;
      line-height: 1;
    }

    .theme-toggle:hover,
    .theme-toggle:focus {
      color: var(--accent);
      transform: scale(1.1);
      outline: none;
    }

    /* Hide both icons by default */
    .light-icon,
    .dark-icon {
      display: none;
    }

    /* Dark mode default / fallback */
    html:not([data-theme]) .dark-icon,
    [data-theme="dark"] .dark-icon {
      display: inline;
    }

    /* Light mode */
    [data-theme="light"] .light-icon {
      display: inline;
    }

    /* Explicitly hide the opposite icon (FIX FOR "10") */
    [data-theme="dark"] .light-icon {
      display: none;
    }

    [data-theme="light"] .dark-icon {
      display: none;
    }

    /* Fix symbol size & alignment */
    .ascii {
      display: inline-block;
      width: 1.1em;
      height: 1.1em;
      line-height: 1;
      text-align: center;
      vertical-align: middle;
      letter-spacing: normal;
      font-family: monospace,
                   'Segoe UI Symbol',
                   'Noto Sans Symbols',
                   'Apple Symbols',
                   sans-serif;
    }

    @media (max-width: 768px) {
      .theme-toggle {
        font-size: 1.5rem;
        padding: 0.5rem;
      }
      .ascii {
        width: 1em;
        height: 1em;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .theme-toggle,
      .ascii {
        transition: none;
      }
    }

    /* ================= SEARCH ================= */

    .header-search {
      padding: 0.75rem 1rem;
      border-top: 1px solid var(--border);
    }

    #siteSearch {
      width: 100%;
      padding: 0.55rem 0.6rem;
      font-family: monospace;
      background: var(--background);
      color: var(--foreground);
      border: 1px solid var(--border);
      border-radius: 4px;
    }

    #searchResults a {
      display: block;
      padding: 0.35rem 0;
      color: var(--accent);
      font-family: monospace;
      text-decoration: none;
    }

    #searchResults a:hover {
      text-decoration: underline;
    }
  </style>

  <!-- ðŸ”Ž Search Logic -->
  <script>
    const input = document.getElementById('siteSearch')
    const results = document.getElementById('searchResults')

    if (input) {
      fetch('/search-index/index.json')
        .then(r => r.json())
        .then(posts => {
          input.addEventListener('input', () => {
            const q = input.value.toLowerCase()
            if (!q) {
              results.innerHTML = ''
              return
            }

            const matches = posts
              .filter(p => p.title.toLowerCase().includes(q))
              .slice(0, 6)

            results.innerHTML = matches
              .map(p => `<a href="${p.url}">${p.title}</a>`)
              .join('')
          })
        })
    }
  </script>
</header>  <!-- All-in-one styles -->
  <style>
    /* === EXISTING STYLES (unchanged) === */
    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.7rem;
      font-family: monospace;
      font-weight: bold;
      padding: 0.4rem 0.9rem;
      margin-left: auto;
      color: var(--foreground);
      transition: color 0.3s ease, transform 0.15s ease;
      line-height: 1;
    }

    .theme-toggle:hover,
    .theme-toggle:focus {
      color: var(--accent);
      transform: scale(1.1);
      outline: none;
    }

    .light-icon,
    .dark-icon {
      display: none;
    }

    html:not([data-theme]) .dark-icon,
    [data-theme="dark"] .dark-icon {
      display: inline;
    }

    [data-theme="light"] .light-icon {
      display: inline;
    }

    .ascii {
      display: inline-block;
      width: 1.1em;
      height: 1.1em;
      text-align: center;
      font-family: monospace;
    }

    /* === SEARCH STYLES === */
    .header-search {
      padding: 0.75rem 1rem;
      border-top: 1px solid var(--border);
    }

    #siteSearch {
      width: 100%;
      padding: 0.55rem 0.6rem;
      font-family: monospace;
      background: var(--background);
      color: var(--foreground);
      border: 1px solid var(--border);
      border-radius: 4px;
    }

    #searchResults a {
      display: block;
      padding: 0.35rem 0;
      color: var(--accent);
      font-family: monospace;
      text-decoration: none;
    }

    #searchResults a:hover {
      text-decoration: underline;
    }
  </style>

  <!-- ðŸ”Ž Search Logic -->
  <script>
    const input = document.getElementById('siteSearch')
    const results = document.getElementById('searchResults')

    if (input) {
      fetch('/search-index/index.json')
        .then(r => r.json())
        .then(posts => {
          input.addEventListener('input', () => {
            const q = input.value.toLowerCase()
            if (!q) {
              results.innerHTML = ''
              return
            }

            const matches = posts
              .filter(p => p.title.toLowerCase().includes(q))
              .slice(0, 6)

            results.innerHTML = matches
              .map(p => `<a href="${p.url}">${p.title}</a>`)
              .join('')
          })
        })
    }
  </script>
</header>
